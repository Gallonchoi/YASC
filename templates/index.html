<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Simple Chat</title>

    <link href="{{ static_url('css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ static_url('css/font-awesome.min.css') }}" rel="stylesheet">
    <link href="{{ static_url('css/chat.css') }}" rel="stylesheet">

    <script src="{{ static_url('js/jquery-2.1.1.min.js') }}"></script>
    <script src="{{ static_url('js/bootstrap.min.js') }}"></script>
    <script>
      $(document).ready(function() {
          var connection = new WebSocket("ws://127.0.0.1:8888/message");
          connection.onmessage = function(event) {
              var obj = jQuery.parseJSON(event.data);
              $("#inbox").append('<li class="left clearfix">                  <span class="chat-img pull-left">                    <img src="http://placehold.it/50/55C1E7/fff" alt="User Avatar" class="img-circle" />                  </span>                  <div class="chat-body clearfix">                    <div class="header">                      <strong class="primary-font">'+ obj.username  +'</strong>                      <small class="pull-right text-muted">                        <i class="fa fa-clock-o fa-fw"></i> 14 mins ago</small>                    </div>                    <p>'+ obj.message +'                    </p>                  </div>                </li>');
          };
          $("#send").click(function() {
              var message = $("#message").val();
              connection.send(message);
          });
          connection.onerror = wsError;
          function wsError(event) {
              console.log("Error: " + event.data);
          }
      });
    </script>
  </head>
  <body>
    <div id="wrapper">
      <div class="row">
        <div class="col-lg-4 col-lg-offset-4">
          <div class="chat-panel panel panel-default">
            <div class="panel-heading">
              <i class="fa fa-comments fa-fw"></i>
                            Simple Chat
              <div class="btn-group pull-right">
                <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                  <i class="fa fa-chevron-down"></i>
                </button>
                <ul class="dropdown-menu slidedown">
                  <li>
                    <a href="#">
                      <i class="fa fa-refresh fa-fw"></i> Refresh
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fa fa-check-circle fa-fw"></i> Available
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fa fa-times fa-fw"></i> Busy
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fa fa-clock-o fa-fw"></i> Away
                    </a>
                  </li>
                  <li class="divider"></li>
                  <li>
                    <a href="/logout">
                      <i class="fa fa-sign-out fa-fw"></i> Sign Out
                    </a>
                  </li>
                </ul>
              </div>
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
              <ul id="inbox" class="chat"></ul>
            </div>
            <div class="panel-footer">
              <div class="input-group">
                <input id="message" type="text" class="form-control input-sm" placeholder="Type your message here..." />
                <span class="input-group-btn">
                  <button id="send" class="btn btn-warning btn-sm">
                                        Send
                  </button>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
